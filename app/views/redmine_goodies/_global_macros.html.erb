<% if (context_submenu_max_height_css = RedmineGoodiesSettings.context_submenu_max_height_css) %>
    <% content_for :header_tags do %>
        <style>#context-menu li.folder ul { max-height: <%= context_submenu_max_height_css %> !important; }</style>
    <% end %>
<% end %>

<% content_for :header_tags do %>
    <%# ============= Register macros  ============= %>
    <%= stylesheet_link_tag 'collapsible_images', :plugin => 'redmine_goodies' %>
    <%= javascript_include_tag 'collapsible_images', :plugin => 'redmine_goodies' %>

    <%= stylesheet_link_tag 'details_system', :plugin => 'redmine_goodies' %>
    <%= javascript_include_tag 'details_system', :plugin => 'redmine_goodies' %>

    <%= stylesheet_link_tag 'questions_system', :plugin => 'redmine_goodies' %>
    <%= javascript_include_tag 'questions_system', :plugin => 'redmine_goodies' %>
<% end %>

<% if RedmineGoodiesSettings.get_setting(:collapsible_images) == '1' %>
    <%= javascript_tag do %>
        document.addEventListener("DOMContentLoaded", (event) => {
            getIsCollapsedValueFromLocalStorage()
        });
    <% end %>
<% end %>

<% if RedmineGoodiesSettings.reposition_context_submenu? %>
    <%= javascript_tag do %>
        jQuery(document).ready(function() {
            // Fix submenu positioning when it gets clipped at the top
            jQuery(document).on('mouseenter', '#context-menu li.folder', function() {
                var $sub = jQuery(this).children('ul').first();
                if ($sub.length === 0) return;
                setTimeout(function() {
                    var el = $sub[0];
                    var rect = el.getBoundingClientRect();
                    if (rect.top < 0) {
                        el.style.top = "0px";
                        el.style.bottom = "auto";
                    }
                }, 50);
            });
        });
    <% end %>
<% end %>

<%= javascript_tag do %>
    document.addEventListener("DOMContentLoaded", (event) => {
        markAnsweredQuestions();
    });
    
    function getTranslationForAnsweredIn(answerNoteId) {
        const translation = "<%= l(:questions_system_answered_in).html_safe %>"
        return translation.replaceAll("undefined", answerNoteId);
    }
<% end %>